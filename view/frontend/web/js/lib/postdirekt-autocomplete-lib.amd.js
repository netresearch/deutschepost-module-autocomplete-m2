define(function(){"use strict";var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};var t,n=function(){return(n=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function o(t,s,a,u){return new(a=a||Promise)(function(r,e){function n(t){try{o(u.next(t))}catch(t){e(t)}}function i(t){try{o(u.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?r(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(n,i)}o((u=u.apply(t,s||[])).next())})}function s(r,n){var i,o,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,(e=s?[2&e[0],s.value]:e)[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=n.call(r,a)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function u(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&n>=t.length?void 0:t)&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function c(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),s=[];try{for(;(void 0===e||0<e--)&&!(n=o.next()).done;)s.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s}(t=T=T||{}).Buildings="buildings",t.Cities="cities",t.Districts="districts",t.PostalCodes="postalcodes",t.PostalCodesCities="postalcodes_cities",t.PostalCodesCitiesDistricts="postalcodes_cities_districts",t.PostalCodesCitiesDistrictsStreets="postalcodes_cities_districts_streets",t.PostalCodesCitiesStreets="postalcodes_cities_streets";var i=T,e=(a.prototype.request=function(n){var i;return o(this,void 0,void 0,function(){var e,r;return s(this,function(t){switch(t.label){case 0:return e=new Request(n.url,{method:n.method,headers:n.headers}),[4,fetch(e)];case 1:return 200<=(r=t.sent()).status&&r.status<300?null!==(i=r.headers.get("Content-Type"))&&void 0!==i&&i.startsWith("application/json")?[2,r.json()]:[2,r.text()]:400===r.status?[2,r.json().then(function(t){throw new Error((r.statusText+": "+t.message).trim())})]:[2,r.text().then(function(t){throw new Error((r.statusText+" "+t).trim())})]}})})},a);function a(){}var l=(d.getAdapter=function(){return new e},d.baseUrl="https://autocomplete2.postdirekt.de/autocomplete2/",d.headers={Accept:"application/json",Authorization:""},d);function d(){}var h=function(t,e,r){void 0===e&&(e="GET"),void 0===r&&(r={}),this.url="",this.method="GET",this.headers={},this.url=t,this.method=e,this.headers=r},p=(f.prototype.create=function(t){var e=t.subject,r=t.country,t=function(t,e){var r={};for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}(t,["subject","country"]);return t.address_type&&this.addressTypeSupported.includes(e)||delete t.address_type,new h(this.buildUrl(r,e,t),"GET",n(n({},l.headers),{Authorization:"Bearer "+this.accessToken}))},f.prototype.buildUrl=function(t,e,r){t=(t=this.baseUrl+"/"+t)+"/"+e;return t+=f.buildQueryString(r)},f.buildQueryString=function(t){t=Object.entries(t).map(function(t){var e=c(t,2),t=e[0],e=e[1];return encodeURIComponent(t)+"="+encodeURIComponent(e)}).join("&");return t=t&&"?"+t},f);function f(t,e){this.addressTypeSupported=[i.PostalCodesCitiesDistrictsStreets,i.PostalCodesCitiesStreets],this.baseUrl=t,this.accessToken=e}var y=(v.prototype.search=function(e){return o(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,this.adapter.request(e)];case 1:return[2,t.sent()]}})})},v);function v(t,e,r){this.adapter=r,this.requestBuilder=new p(e,t)}var b,m,g,w=(r(m=C,g=b=p),m.prototype=null===g?Object.create(g):(S.prototype=g.prototype,new S),C.prototype.create=function(t){return b.prototype.create.call(this,t)},C);function S(){this.constructor=m}function C(){return null!==b&&b.apply(this,arguments)||this}var E=(A.prototype.select=function(e){return o(this,void 0,void 0,function(){return s(this,function(t){return[2,this.adapter.request(e)]})})},A);function A(t,e,r){this.adapter=r,this.requestBuilder=new w(e,t)}var T,j=(x.createSearchService=function(t){return new y(t,l.baseUrl+"search",l.getAdapter())},x.createSelectService=function(t){return new E(t,l.baseUrl+"select",l.getAdapter())},x.prototype.createSearchService=function(t){return x.createSearchService(t)},x.prototype.createSelectService=function(t){return x.createSelectService(t)},x);function x(){}(T=k=k||{}).A="A",T.F="F",T.P="P";var P=k,O=(_.prototype.getByUuid=function(e){return this.suggestions.find(function(t){return t.uuid===e})||null},_);function _(){this.suggestions=[]}var k,U=(Object.defineProperty(D.prototype,"address",{get:function(){var r={city:"",postalCode:"",street:""};return this.inputMap.forEach(function(t,e){r[e]=t.value}),r},set:function(t){var e,r;try{for(var n=u(this.inputMap),i=n.next();!i.done;i=n.next()){var o=c(i.value,2),s=o[0],a=o[1];a.value=t[s],a.dispatchEvent(new Event("change"))}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},enumerable:!1,configurable:!0}),D);function D(t){this.inputMap=t}(k=B=B||{}).ArrowUp="ArrowUp",k.ArrowDown="ArrowDown",k.Enter="Enter",k.Tab="Tab";var F,B,q=B,I=(L.prototype.render=function(e,t){var r=this;if(!e.parentElement)throw Error("Input elements without a parent cannot be assigned a suggestion list.");this.remove(),(this.currentField=e).setAttribute("autocomplete","off");var n=document.createElement("ul");n.setAttribute("id","datalist-"+e.id),n.setAttribute("class","datalist"),n.setAttribute("style","width:"+e.offsetWidth+"px; top:"+e.offsetHeight+"px;"),t.map(function(t){return{id:t.uuid,title:[t.street,t.postalCode,t.city].filter(Boolean).join(", ")}}).forEach(function(t){var e=document.createElement("li"),r=document.createTextNode(t.title);e.setAttribute("id",t.id),e.setAttribute("data-value",t.title),e.appendChild(r),n.appendChild(e)}),e.parentElement.appendChild(n),e.parentElement.classList.add("autocomplete-container"),e.setAttribute("list","datalist-"+e.id),n.addEventListener("mousedown",function(t){t=t.target;r.itemSelect(t),setTimeout(function(){return e.focus()},0)}),e.addEventListener("focusout",this.remove.bind(this)),this.removableEventHandler=this.navigationKeyListener.bind(this),e.addEventListener("keydown",this.removableEventHandler)},L.prototype.remove=function(){var t;this.removableEventHandler&&this.currentField&&((t=document.querySelector('[id="datalist-'+this.currentField.id+'"]'))&&t.remove(),this.currentField.removeEventListener("keydown",this.removableEventHandler),this.currentField=void 0)},L.prototype.navigationKeyListener=function(t){t.key in q&&(t.key!==q.Tab&&t.preventDefault(),this.triggerKeydown(t.key))},L.prototype.triggerKeydown=function(t){var e,r,n,i,o,s;!this.currentField||(e=document.querySelector('[id="datalist-'+this.currentField.id+'"]'))&&(r=Array.from(e.children),n=e.querySelector("[data-active]"),i=r.find(function(){return!0}),!n&&t===q.Enter||(t!==q.ArrowDown||n?n&&(s=o=null,r.forEach(function(t,e,r){t===n&&(o=r[e-1],s=r[e+1])}),n.removeAttribute("data-active"),t===q.ArrowUp&&(o?(o.setAttribute("data-active","true"),o.offsetTop<e.scrollTop&&(e.scrollTop-=o.offsetHeight)):r[r.length-1].setAttribute("data-active","true")),t===q.ArrowDown&&(s||r[0]).setAttribute("data-active","true"),t===q.Tab&&this.currentField.focus(),[q.Enter,q.Tab].includes(t)&&this.itemSelect(n)):i.setAttribute("data-active","true")))},L.prototype.itemSelect=function(t){this.currentField&&(this.currentField.dataset.suggestionUuid=t.id,this.currentField.dispatchEvent(new Event("autocomplete:datalist-select")),this.remove())},L);function L(){}(B=F=F||{}).City="city",B.Street="street",B.PostalCode="postalCode";var M=F,K=(R.prototype.render=function(t,e){if(!t.parentElement)throw Error("Input elements without a parent cannot be assigned a infobox.");var r=document.createElement("div"),n=document.createElement("span");r.setAttribute("class","autocomplete-infoBox"),r.setAttribute("id","autocomplete-hint"),n.innerHTML=e,r.appendChild(n),this.infoBox=r,t.parentElement.appendChild(r)},R.prototype.remove=function(){this.infoBox=void 0},R);function R(){}var H=(G.prototype.start=function(){var e,t;try{for(var r=u(this.inputMap.values()),n=r.next();!n.done;n=r.next()){var i=n.value;i.addEventListener("keyup",this.handleFieldKeystroke.bind(this)),i.addEventListener("autocomplete:datalist-select",this.handleDatalistSelect.bind(this))}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}this.countrySelect.addEventListener("change",this.handleCountryChange.bind(this))},G.prototype.handleFieldKeystroke=function(t){var e=this;this.countrySelect.value===this.deCountryId&&(this.navigationKeyCodes.includes(t.code)||this.triggerDelayedCallback(function(){return e.searchAction(t.target)},this.typingDelay))},G.prototype.handleDatalistSelect=function(t){var e=t.target,r=e.dataset.suggestionUuid,t=this.addressSuggestions.getByUuid(r),r=this.inputMap.get(M.Street);t&&(this.domAddress.address=t,this.selectAction(t.uuid),r&&this.hint&&r===e&&this.hintRenderer.render(r,this.hint))},G.prototype.handleCountryChange=function(){this.countrySelect.value!==this.deCountryId&&this.listRenderer.remove()},G.prototype.triggerDelayedCallback=function(t,e){this.timeoutId,clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(t,e)},G.prototype.searchAction=function(e){var r=this,t=this.domAddress.address,n=t.street?i.PostalCodesCitiesStreets:i.PostalCodesCities;""!==Object.values(t).join("").trim()&&this.searchService.search(this.searchService.requestBuilder.create({country:"de",subject:n,combined:Object.values(t).join(" "),address_type:P.A})).then(function(t){r.addressSuggestions.suggestions=t.addresses.filter(function(t){return!!t.uuid}).map(function(t){return{street:t.street||"",postalCode:t.postalCode||"",city:t.city||"",uuid:t.uuid,district:t.district}}),e===document.activeElement&&r.listRenderer.render(e,r.addressSuggestions.suggestions)})},G.prototype.selectAction=function(t){this.selectService.select(this.selectService.requestBuilder.create({country:"de",subject:i.PostalCodesCitiesStreets,uuid:t}))},G);function G(t,e,r,n,i){this.navigationKeyCodes=["ArrowUp","ArrowDown","Escape","Enter","Space","Tab"],this.typingDelay=500,this.inputMap=t,this.countrySelect=e,this.deCountryId=r,this.searchService=j.createSearchService(n),this.selectService=j.createSelectService(n),this.addressSuggestions=new O,this.domAddress=new U(this.inputMap),this.listRenderer=new I,this.hintRenderer=new K,this.hint=i}return{init:function(t,e,r,n,i,o,s){s=new H(new Map([[M.Street,t],[M.PostalCode,r],[M.City,e]]),n,i,o,s);return s.start(),s}}});
//# sourceMappingURL=postdirekt-autocomplete-lib.amd.js.map
